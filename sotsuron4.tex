\documentclass[a4paper,12pt]{jbook}

\setlength { \textwidth } {40zw }

%卒業論文用スタイルファイル
\usepackage{sotsuron}
\usepackage{ascmac}

\begin{document}
%--------------表紙はじめ-----------------------------
{\Large
\title{
	{\bf 平成30年度 卒業論文}\\[2cm]
	{\Large 題\ \ \ 目}\\[0.5cm]
	{\underline{分割主鏡制御のための積分要素を考慮した}\\
         \underline{パラメータ推定手法に関する研究}\\
	\vspace{1cm}}}

\author{
	指導教員\\[0.2cm]  
	\underline{軸屋　一郎　准教授}\\[1.5cm]
  	{\Large 報告者}\\[0.2cm] 
	\underline{新村　拓海} \\[1.5cm]
 	平成 30 年 2 月 23\ 日\\[1.5cm]
 	金沢大学理工学域電子情報学類電気電子コース}
}
\date{}
\maketitle
\frontmatter

%--------------概要はじめ--------------------------------
\begin{center} 
	{\bf \large 概要}\\[0.2cm] 
\end{center}
\addcontentsline{toc}{chapter}{概要}
\pagenumbering{roman}
%
京都大学が主体となって制作している「せいめい望遠鏡」では, 大口径化のため鏡を分割して並べる分割主鏡を用いている.
この場合, 鏡の位置誤差による星像劣化などのために, 各分割主鏡間の相対位置の制御が求められている.
ここで, 制御のために対象の数学モデルを構築するシステム同定をする必要がある.
%
現在はセンサとアクチュエータの位置関係から幾何学的にモデルを推定しているが, 実際の入出力関係から推定したパラメータも考慮することによりモデル化誤差を減らすことが可能であると考えられる.しかし, 制御対象として, 鏡の回転角速度を入力として, 入力を積分した位置を制御対象とする積分器を有するシステムであり, 
積分要素が推定精度を劣化させることがある.
%
このようなシステムでは, 積分器を含むことを陽に用いたシステム同定手法が求められる.
ところで, 積分器を有することを陽に用いたシステム同定では, １入力１出力(SISO:Single Input Single Output)システムにおけるシステム同定が\cite{sysiden_a}により示されているが,本稿では, 多入力多出力システムにおける同定手法を述べる.

%--------------目次-----------------------------------
\tableofcontents
%\thispagestyle{empty}
\abovedisplayskip = 4pt
\belowdisplayskip = 4pt
\setcounter{tocdepth}{2}

\mainmatter
\newpage
%------------------------------------------------------------------------
\chapter{はじめに}
%------------------------------------------------------------------------
%------------------------------------------------------------------------
\section{分割鏡}
%------------------------------------------------------------------------

天体観測用の望遠鏡は空間分解能の向上と集光力の増加の要請から大口径化の一途をたどっている．\cite{tele_b}京都大学が主体となって建設している「せいめい望遠鏡」では,大口径化のため分割主鏡という方式を採用している.しかし, 望遠鏡は観測の際に外気に触れるため, 風や重力変形, 熱変形といった外乱の影響を受けて分割主鏡がずれてしまう問題がある.そのため, 分割鏡を並べて１枚の主鏡として機能させるためには分割鏡を精密に制御をする必要がある.
分割鏡には, 下図のように$α$, $β$, $z$の3つの自由度がある.
\begin{figure}[htbp]
 \begin{center}
  \includegraphics[width=100mm]{seg.eps}
 \end{center}
 \caption{鏡の全体図}
 \label{fig:seg}
\end{figure}

\newpage
この分割鏡を並べた全体図を下図に示す.
\begin{figure}[htbp]
 \begin{center}
  \includegraphics[width=100mm]{over.eps}
 \end{center}
 \caption{鏡の全体図}
 \label{fig:over}
\end{figure}

ここでは, 分割主鏡の鏡面を下す方向から表示している.
また, 分割主鏡には, 72個のセンサと54個のアクチュエータが取り付けられている.\cite{tele_a}
%------------------------------------------------------------------------
\section{連続時間においての制御対象の状態空間モデル} 
%------------------------------------------------------------------------
制御対象の状態空間モデルは以下で与えられる.
\begin{align}
\dot{x}(t) &= u(t) \label{eqn:syscon01} \\
y(t) &= C x(t) \label{eqn:syscon02}
\end{align}

$x(t) \in \mathbb{R}^{54}$は状態を表し, $α_k [rad]$, $β_k [rad]$, $z_k [mm] (k=1, 2, \dots , 18)$から構成される.

$u(t) \in \mathbb{R}^{54}$は速度入力を表し, $\dot{α_k} [rad/s]$, $\dot{β_k} [rad/s]$, $\dot{z_k} [mm/s]$から構成される.

$y(t) \in \mathbb{R}^{72}$は出力を表し, 各センサの情報から構成される.

$C \in \mathbb{R}^{72\times54}$はセンサの位置とアクチュエータの位置の変換行列を表す.
\newpage
\cite{tele_a}では, 公称モデルとして行列$C$を幾何学的に求めているが, これを得る際に行われる近似によって, モデル化誤差が生じてしまう. これに対して, 入出力情報を用いて行列$C$のパラメーター推定(以降システム同定とよぶ)をおこなうことが本論文の主たる目的である. この際, 以下の４点に注意してシステム同定をおこなう.
\newtheorem{A}{A}　
\begin{A}
積分器を含むため不安定なシステムであること.
\end{A}

\begin{A}
離散時間データを用いてシステム同定を行うこと.
\end{A}

\begin{A}
多入力多出力のシステムであること.
\end{A}

\begin{A}
システムに雑音を含むこと
\end{A}

A1に関しては, \cite{sysiden_a}によって積分器が存在することを陽に用いたシステム同定手法が示されている. \cite{sysiden_a}においては１入力１出力のシステム同定であり, 本研究ではA3という点でシステム同定を難しくしている. しかし, 積分要素以外は入力の過去の履歴には依存しないという点でシステム同定を容易にしている.

A3に関しては, \cite{tele_a}においては連続時間で推定をおこなっているが, 式(\ref{eqn:syscon01})および式(\ref{eqn:syscon02})を離散時間システムに書き直す. この際に考える近似手法は\ref{secsim}により議論する. また, システム同定の研究として, より多くのシステムに対応できるようにより一般化して積分器を含み, 積分要素以外は入力の過去の履歴には依存しない多入出力システムを対象として議論を進める. 

A4に関しては, \cite{tele_a}においては雑音を考慮していないが入出力データを利用することから雑音を考慮してシステム同定おこなう必要がある.

%------------------------------------------------------------------------
\section{離散時間システムを得るための近似} \label{sec:sim}
%------------------------------------------------------------------------

連続時間システムを離散時間システムに変換する際にAD変換では量子化誤差を無視し, サンプリングと量子化に時間遅れがないものと仮定する.

すなわち, 連続時間信号$y(t)$のサンプリング値は次式で与えられる.
\begin{align}
 y[k] &= y(kτ) \label{eqn:sample}
\end{align}

積分処理をするために, ディジタル信号を時間的に連続な操作量に直す必要があるが, その際にDA変換器として０次ホールドの特性を持つと仮定する.

%------------------------------------------------------------------------
\chapter{同定対象のモデリング}
%------------------------------------------------------------------------
%------------------------------------------------------------------------
\section{一般化されたモデリング}
%------------------------------------------------------------------------
式(\ref{eqn:syscon01})および式(\ref{eqn:syscon02})を\ref{sec:sim}のもと離散時間システムに変換直す.そして, 更に一般化するため雑音を考慮して, $n$入力, $p$出力のシステムとして考える.ここで, 簡単のためサンプリング周期$τ=1$とするが, サンプリング周期$τ$によらず同様の議論ができる.
\begin{align}
 x(k+1) &= x(k) + u(k) + d_a(k) +d_b(k) \label{eqn:sys01} \\
 y(k) &= C x(k) + w(k) \label{eqn:sys02}\\
 u_m(k) &= u(k) + e_u(k) + d_a(k) \label{eqn:sys03}\\
 y_m(k) &= y(k) + e_y(k) \label{eqn:sys04}
\end{align}


$C \in \mathbb{R}^{p\times n}$は縦長行列($p > n$)であり, 列フルランクと仮定する.
また, 変数名と次元は下表に示す.\\

\begin{table}[htb]
  \begin{center}
    \begin{tabular}{|l|l|}
     \hline
      変数 & 変数名 \\ \hline \hline
      $u \in \mathbb{R}^n$ & 入力ベクトル \\ \hline
      $x \in \mathbb{R}^n$ & 状態ベクトル \\ \hline
      $y \in \mathbb{R}^p$ & 出力ベクトル \\ \hline
      $u_m \in \mathbb{R}^p$ & 観測入力ベクトル \\ \hline
      $y_m \in \mathbb{R}^p$ & 観測出力ベクトル \\ \hline
      $d_a \in \mathbb{R}^p$ & 入力既知雑音ベクトル \\ \hline
      $d_b \in \mathbb{R}^p$ & 入力未知外乱ベクトル \\ \hline
      $w \in \mathbb{R}^p$ & 出力外乱ベクトル \\ \hline
      $e_u \in \mathbb{R}^p$ & 入力観測外乱ベクトル \\ \hline
      $e_y \in \mathbb{R}^p$ & 出力観測外乱ベクトル \\ \hline
    \end{tabular}
　 \caption{変数名と次元} 
  \end{center}
\end{table}
システム同定のための入力$u$はPE性の次数の大きいものが求められるため疑似白色信号を想定し, 平均$0$であると想定する. $y_m$は観測誤差を想定し, 正規分布を仮定する. $d_a$は入力$u$のバイアスを想定し, 一定値雑音を想定する. $d_b$はシステムに入り込む熱変形や, 風などによる外乱を想定し, 正規分布を仮定する.

ちなみに, 一般的な離散時間システムは次式で与えられる.
\begin{align}
 x(k+1) &= A x(k) + B u(k) \label{eqn:sys1} \\
 y(k) &= C x(k) + D w(k) \label{eqn:sys2}
\end{align}
本稿では, 積分要素以外は入力の過去の履歴には依存しないシステムを同定対象とする.そのため, 今回考えるシステムは上式において$A$は単位行列である. また, 入力$u$の積分が状態$x$となる場合を考えて$B$は単位行列となっている.

\newpage
このシステムのブロック線図を下図に示す.\\
\begin{figure}[htbp]
 \begin{center}
  \includegraphics[width=100mm]{block0.eps}
 \end{center}
 \caption{同定対象のブロック線図}
 \label{fig:block0}
\end{figure}\\

ここで, $q$は以下の等式が成り立つシフトオペレーター$q$とする.
\begin{align}
qx(k) &= x(k + 1) \label{eqn:shiftq}
\end{align}

離散時間システムにおいて, 積分要素は下図のように表され, このシステムは下図と同様の要素を含むため積分器を含むシステムであることに注意したい.
\begin{figure}[htbp]
 \begin{center}
  \includegraphics[width=100mm]{integral.eps}
 \end{center}
 \caption{同定対象の積分要素}
 \label{fig:integral}
\end{figure}

%------------------------------------------------------------------------
\section{問題設定}
%------------------------------------------------------------------------
本稿では, 以下の２つの仮定をする.
\newtheorem{仮定}{仮定}
\begin{仮定}
$d_a(k)$および$e_u(k)$が一定値雑音である.
\end{仮定}
\begin{仮定}{}
$u(k)$および雑音, 外乱$d_a$, $d_b$, $e_u$, $e_y$, $w$全てが時不変である.
\end{仮定}

$C$の推定値を$C_{est}$, $x$の推定値を$\hat{x}$とする.

仮定１および仮定２のもと, $u_m$および$y_m$から$C_{est}$を推定する問題を考える.

前処理を行わず, ノイズの影響を考えない場合の$C_{est}$を用いたブロック線図を下図に示す. \\
\begin{figure}[htbp]
 \begin{center}
  \includegraphics[width=100mm]{block2.eps}
 \end{center}
 \caption{$C_{est}$を用いたブロック線図}
 \label{fig:block2}
\end{figure}

この$C_{est}$を用いて, 以下のように$C$と$C_{est}$の差のユークリッドノルムの評価関数$J$と定義する.\\
\begin{align}
 J &:= \|C-C_{est}\| \label{eqn:j}
\end{align}

この評価関数$J$を最小化するような$C_{est}$が得られるような前処理をし, 推定する問題を考える.
%------------------------------------------------------------------------
\chapter{システム同定}
%------------------------------------------------------------------------
%-------------------------------------------------------------
\section{同定アルゴリズム} \label{sec:est}
%-------------------------------------------------------------
本稿により, 作用行列$C$を推定する際は, 以下の手法で推定することができることを\ref{sec:henkei}において証明する..\\
\begin{screen}
\underline{作用行列の推定法}\\
{\bf step1} 入力の観測値の積分$V$を得る.\\
{\bf step2} $V(k-1)$と$Y_m(k)$から1次トレンドを除去する. 
\ \ \\除去後得られたものをそれぞれを$dV(k-1)$, $dY_m(k)$とする.\\
{\bf step3} $C_{est} = ( dY_m(k) ) \{ dV(k-1) \}^{\dagger}$から推定する.
\end{screen}

step1およびstep2は\cite{sysiden_a}と同様の前処理法である. この前処理方法の有効性も
\ref{sec:henkei}で示す.

%------------------------------------------------------------------------
\section{簡単化されたモデリング}
%------------------------------------------------------------------------

同定をおこなう際に簡単のため$d_b$が加わってない場合で話をすすめる. ただし$d_b$も$e_u$と同様の処理により推定精度への影響を除去することができる. この場合の簡単化された同定対象のモデルは下記の$n$入力, $p$出力の離散時間システムに書き直される.\\
\begin{align}
 x(k+1) &= x(k) + u(k) \label{eqn:sys11} \\
 y(k) &= C x(k) + w(k) \label{eqn:sys12}\\
 u_m(k) &= u(k) + d_a(k) \label{eqn:sys13}\\
 y_m(k) &= y(k) + e_y(k) \label{eqn:sys14}
\end{align}
\newpage
また, このシステムのブロック線図を下図に示す.\\
\begin{figure}[htbp]
 \begin{center}
  \includegraphics[width=100mm]{block1.eps}
 \end{center}
 \caption{簡単化された同定対象のブロック線図}
 \label{fig:block1}
\end{figure}

%-------------------------------------------------------------
\section{定式化}
%-------------------------------------------------------------

本節では, $C$の数値計算を行うために, モデリング対象を定式化する.

式(\ref{eqn:sys11})より, 状態ベクトル$x(k)$は, \\
\begin{align}
x(k) &= x(k-1) + u(k-1) + d_a(k-1)\\
&= x(k-2) + u(k-1) + d_a(k-1) + u(k-2) + d_a(k-2)\\
&= \cdots \\
&= x(0) + \sum_{i=0}^{k-1} u(i) + \sum_{i=0}^{k-1} d_a(i)\label{eqn:x0}
\end{align}
である.

また, $(u + d_a)$の数値積分を$v(k)$として以下のように定義する.\\
\begin{align}
v(k) &:= \sum_{i=0}^{k} u(i) + \sum_{i=0}^{k} d_a(i)\label{eqn:v0}
\end{align}

そうすると, 式(\ref{eqn:sys12}), 式(\ref{eqn:sys14}), 式(\ref{eqn:x0})より観測出力$y_m(k)$を以下のように書き直すことができる.\\
\begin{align}
 y_m(k) = C x(0) + C v(k-1) + w(k) + e_y(k) \label{eqn:ym0}
\end{align}\\

実際に観測される入力側の積分は観測入力の積分\^xであり, これは$e_u$が一定値であることに注意して以下のように表される.\\
\begin{align}
\hat{x}(k) &= x(0) + v(k-1) + \sum_{i=0}^{k-1} e_u(i) \\
&= x(0) + v(k-1) + ke_u \label{eqn:xtil0}
\end{align}\\

すると, $C_{est}$を用いて観測出力$y_m(k)$を以下のように書き直すことができる.

\begin{align}
y_m(k) &= C_{est} x(0) + C_{est} v(k-1) + ke_u + w(k) + e_y(k) \label{eqn:ym1}
\end{align}\\

%-------------------------------------------------------------
\section{式変形} \label{sec:henkei}
%-------------------------------------------------------------

本章からは, 式変形をするため以下のように変数を行列化して表す.

大文字で変数は小文字の変数の行列とする.

ここで, Nは同定に用いるデータ長とする.\\
\begin{align}
Y_m(k) &= \begin{bmatrix} y_m(k+0) & y_m(k+1) & \cdots & y_m(k+N) \end{bmatrix}  \label{eqn:vecym} \\
X(0) &= \begin{bmatrix} x(0) & x(0) & \cdots & x(0) \end{bmatrix}  \label{eqn:vecx0} \\
V(k-1) &= \begin{bmatrix} v(k-1) & v(k) & \cdots & v(k-1+N) \end{bmatrix}  \label{eqn:vecv}\\
E_u(k) & = \begin{bmatrix} e_u(k) & e_u(k+1) & \cdots & e_u(k+N) \end{bmatrix}  \label{eqn:veceu}\\
W(k) & = \begin{bmatrix} w(k) & w(k+1) & \cdots & w(k+N) \end{bmatrix}  \label{eqn:vecw}\\
E_y(k) & = \begin{bmatrix} e_y(k) & e_y(k+1) & \cdots & e_y(k+N) \end{bmatrix}  \label{eqn:vecey}
\end{align}

これによって行列を用いて, 式は以下のように表すことができる.\\
\begin{align}
Y_m(k) &= C_{est} X(0) + C_{est} V(k-1) + kE_u + W(k) + E_y(k) \label{eqn:vecym}
\end{align}

本稿では, $E[ \cdot ]$は期待値演算を表し, $\overline{・}$はその確率変数の平均とし, 平均は以下のように標本平均で近似する.
\begin{align}
\overline{u} &\simeq \frac{1}{N+1} \sum_{i=0}^N u(k+i)
\end{align}

行列の期待値は信号の各時刻の期待値の行列であるとし, 各時刻において期待値を標本平均で近似する.

すなわち, $E[U]$および$E[W]$は以下のように表す.\\
\begin{align}
E[U] &\simeq \begin{bmatrix} \overline{u} & \overline{u} & \cdots & \overline{u} \end{bmatrix}  \label{eqn:vecuave} \\
E[E_y] &\simeq \begin{bmatrix} \overline{e_y} & \overline{e_y} & \cdots \overline{e_y} \end{bmatrix}\label{eqn:veceyave} \\
E[W] &\simeq \begin{bmatrix} \overline{w} & \overline{w} & \cdots \overline{w} \end{bmatrix} \label{eqn:vecwave} 
\end{align}

$V(k)$は, $(u(k)+d_a)$の積分の行列であるから, $V(k)$の期待値$E[V(k)]$は以下のように表わされる.\\
\begin{align}
E[V(k)]&:= \begin{bmatrix} E[v(k)] & E[v(k+1)] & \cdots & E[v(k+N)] \end{bmatrix}\\
&= \begin{bmatrix} k(\overline{u} + d_a) & (k+1)(\overline{u}+ d_a) & \cdots & (k+N)(\overline{u}+ d_a) \end{bmatrix}  \label{eqn:vecvave}
\end{align}

これらを用いて, $y_m(k)$の期待値の行列は$E[Y_m(k)]$以下のように表される.\\
\begin{align}
E[Y_m(k)] &= E[C_{est} X(0)] + E[C_{est} V(k-1)] \\ &+ E[ke_u] + E[W(k)]+ E[E_y(k)] \\
 &= C_{est} X(0) + C_{est}E[V(k-1)] + kE_u + E[W] + E[E_y]   \label{eqn:vecymave} 
\end{align}

式(\ref{eqn:vecym})から期待値$E[Y_m(k)]$を差し引くと以下の等式が成り立つ

\begin{align}
Y_m(k) - E[Y_m(k)] &= C_{est} \{V(k-1) -E[V(k-1)]\}\\ 
&+ W(k) - E[W(k)] + E_y(k) - E[E_y(k)]\label{eqn:y=cv0}
\end{align}

$W(k)$および$E_y(k)$は, 平均が除去されていること, 入力の積分要素を含む$V(k-1)$に対して十分小さいため以下のように近似できる.
\begin{align}
Y_m(k) - E[Y_m(k)] &\simeq C_{est} \{V(k-1) -E[V(k-1)]\} \label{eqn:y=cv1}
\end{align}

ここで$v(k-1) - v_{aff}(k-1)$が行フルランクと仮定する. すると上式に$v(k-1) - v_{aff}(k-1)$の擬似逆行列$\{ v(k-1) - v_{aff}(k-1) \}^{\dagger}$をかけて推定値$C_{est}$が得られる.

\begin{align}
 C_{est} &= ( Y_m(k) -  E[Y_m(k)] ) \{ V(k-1) - E[V(k-1)] \}^{\dagger}  \label{eqn:cest} 
\end{align}

$E[Y_m(k)]$は$Y_m$の線形近似であり, $E[V(k-1)]$は$V(k-1)$の線形近似である.

よって\ref{sec:est}で述べたアルゴリズムにより$C$を推定することができることが示せた.
%------------------------------------------------------------------------
\chapter{数値例}
%------------------------------------------------------------------------
あ
%------------------------------------------------------------------------
\chapter{雑音の種類による推定精度への影響}
%------------------------------------------------------------------------
あ
%-------------------------------------------------------------
\section{観測雑音に大きな分散が加わった場合の影響}
%-------------------------------------------------------------

$e_u$および$d_b$が一定値雑音ではなく, 分散が大きい場合は, これを積分した確率変数は積分した区間が長くなるにつれて分散が増大するため, 同定時間の長さを増やすことによって積の同定に用いるデータ長を増やしても同定精度の向上が見られないと考えられる.
%-------------------------------------------------------------
\section{雑音の種類のマルバツ表}
%-------------------------------------------------------------
%------------------------------------------------------------------------
\chapter{おわりに}
%------------------------------------------------------------------------
ソースコード
%------------------------------------------------------------------------
\chapter*{謝辞}
\addcontentsline{toc}{chapter}{謝辞}
本研究を進めるにあたり，終始ご指導，ご鞭撻を賜りました金沢大学大学院自然科学研究科\ 電子情報科学専攻\ 軸屋\ 一郎\ 准教授に甚大なる謝意を表します．  
%------------------------------------------------------------------------
\chapter*{本研究に関する発表論文}
\addcontentsline{toc}{chapter}{本研究に関する発表論文}
[1]本研究に関する卒論発表, 金子 修, 山科 勇輔, 和田垣 祐介,“FRITによる内部モデル制御のパラメータチューニング(仮),”第54回システム制御情報学会研究発表講演会, 奈良先端科学技術大学院大学, 2010年5月19日〜5月21日(掲載予定).
\clearpage
\addcontentsline{toc}{chapter}{参考文献}     %目次に表示させる
\begin{thebibliography}{2}
\bibitem{tele_a}
上野　幸紀, 軸屋　一郎, 新村　拓海, 木野　勝, 山田 克彦:
\ せいめい望遠鏡の分割鏡制御の概念設計.
\bibitem{tele_b}
木野　勝, 軸屋 一郎:
\ 分割主鏡とその制御. 計測と制御, 2017 年 56 巻 6 号, p. 449-454, 2017.
\bibitem{sysiden_a}
竹下 侑, 川口 貴弘, 足立 修一:
\ 積分器を有するシステムの同定について, 計測自動制御学会論文集, 50 巻 (2014) 4 号, p. 342-347, 20１4.
\bibitem{sysiden_b}
板井 謙太朗, 奥 宏史:
\ 積分器を含むシステムの同定実験, 第57回自動制御連合講演会\ p. 1455-1458, 2014.
\bibitem{sysiden_a}
足立 修一:
\ システム同定の基礎, 計測自動制御学会論文集, 東京電機大学出版局, 2009.
\bibitem{text_sys}
\end{thebibliography}


\end{document}